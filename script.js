String.prototype.replaceAt=function(e,t){return this.substring(0,e)+t+this.substring(e+1,this.length)},String.prototype.middleAdd=function(e,t){return this.substring(0,e)+t+this.substring(e,this.length)},String.prototype.replaceAll=function(e,t,r){return this.replace(RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),r?"gi":"g"),"string"==typeof t?t.replace(/\$/g,"$$$$"):t)},fetch("./key.json").then(e=>e.json()).then(e=>{asyncCall(e)});var timer="";function asyncCall(e){let t=$('[name="Unicode"]'),r=$('[name="Classic"]');r.focus();let l="",n=0,a="";var i=0;function s(){value=t.val();var l="";new Promise(t=>{if(value){var r=e[0][1];for(var l of r)value=value.replaceAll(l.out,l.seq),l==r[r.length-1]&&t(value)}}).then(t=>new Promise(r=>{var n="";for(l of t){var a=transform(!1,l,e[0][0]);if(a){var i,s=transform(parseInt(a[0]),!1,e[1][0]);if(s)i=a[3]?s[2]:s[1];else{var o=["0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","*","(",")","?",",","<",".",">","=","+",":",";","/"],c=["০","১","২","৩","৪","৫","৬","৭","৮","৯","!","@","#","৳","%","ৰ","*","(",")","?",",","<",".",">","=","+",":",";","/"];for(var f of c)l==f&&(i=o[c.indexOf(f)])}i+=n,n="","‰"==i||"w"==i||"‡"==i?"&"==l[l.length-2]?(l="&"==l[l.length-4]?l.middleAdd(l.length-5,i):l.middleAdd(l.length-3,i),i=""):"\xa9"==l[l.length-1]?(l=l.middleAdd(l.length-2,i),i=""):"&"!=l[l.length-1]&&(l=l.middleAdd(l.length-1,i),i=""):"&"==i&&"i"==l[l.length-1]&&("‍"!=n?(i="",l=l.replaceAt(l.length-1,""),n="\xa9"):n=""),l+=i}else if("়"==l){switch(l[l.length-1]){case"h":l+="q";break;case"W":l+="o";break;case"X":l+="p"}l=l.replaceAt(l.length-2,"")}else"‍"==l&&(n=l);l==t[t.length-1]&&r()}})).then(()=>{if(l.length>=2)for(var t of e[1][1])l=l.replaceAll(t.seq,t.out);r.val(l)})}function o(){value=r.val(),l="";var i="";new Promise(t=>{if(value){var r=e[1][1];for(var l of r)value=value.replaceAll(l.out,l.seq),l==r[r.length-1]&&t(value)}}).then(t=>new Promise(r=>{for(l of t){var s=transform(!1,l,e[1][0]);if(s){var o=transform(parseInt(s[0]),!1,e[0][0]),f=(s[3]?o[2]:o[1])+l,d=i[i.length-1];if("্"!=d)switch(f){case"ে":case"ৈ":case"ি":l=f,f="";break;case"র্":i=i.middleAdd(i.length-1,f),f="";break;case"্":("ে"==d||"ৈ"==d||"ি"==d)&&(a=d,n=i.length+1,i=i.replaceAt(i.length-1,""));break;default:l=""}i+=f,n&&i.length===n&&(i+=a,n=0,l="")}else{var _=["0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","*","(",")","?",",","<",".",">","=","+",":",";","/","\n"],h=["০","১","২","৩","৪","৫","৬","৭","৮","৯","!","@","#","৳","%","ৰ","*","(",")","?",",","<",".",">","=","+",":",";","/","\n"];for(var g of _)l==g&&(i+=h[_.indexOf(g)])}i=c(i,e[0][1]),l==t[t.length-1]&&r()}})).then(()=>{t.val(i)})}function c(e,t){var r;for(var l of(r=e.length>=5?e.substring(e.length-5,e.length):e,t))r=r.replace(l.seq,l.out);return e.substring(0,e.length-5)+r}t.on("keydown",r=>{let o=r.keyCode,f=r.shiftKey,d=r.ctrlKey,_=r.altKey,h=transform(o,!1,e[0][0]);if(h){if(d||_)console.warn("Externel...");else{r.preventDefault();let g=t.val(),v=document.getElementsByName("Unicode")[0],y=v.selectionEnd;if(v.selectionStart!=y){var u,p=v.selectionStart;i-=y-p,g=g.substring(0,p)+g.substring(y,g.length),y=p}u=y>0?g[y-1]:"";let m=(f?h[2]:h[1])+l;if(l&&(g=g.replaceAt(y-1,""),y-=1,i-=1),"্"!=u)switch(m){case"ে":case"ৈ":case"ি":l=m;break;case"র্":g="ে"==u||"ৈ"==u||"ি"==u?g.middleAdd(y-2,m):g.middleAdd(y-1,m),m="";break;case"্র":case"্য":case"্":("ে"==u||"ৈ"==u||"ি"==u)&&(a=u,n=g.length+1,g=g.replaceAt(y-1,""));break;default:l=""}g=g.middleAdd(y,m),n&&g.length===n&&(console.log(y),g=g.middleAdd(y+1,a),n=0,l=""),t.val(c(g,e[0][1])),m&&(y+=(curlength=t.val().length)-i,i=curlength,v.selectionEnd=y)}clearTimeout(timer),timer=setTimeout(s,1e3)}else 8==o&&(i-=1,clearTimeout(timer),timer=setTimeout(s,1e3))}),r.on("keydown",t=>{let n=t.keyCode,a=t.shiftKey,i=t.ctrlKey,s=t.altKey,f=transform(n,!1,e[1][0]),d="";if(f){if(i||s)l="";else{t.preventDefault(),d=r.val();var _=document.getElementsByName("Classic")[0];let h=_.selectionEnd;if(_.selectionStart!=h){var g=_.selectionStart;d=d.substring(0,g)+d.substring(h,d.length),h=g}let v=a?f[2]:f[1];d=d.middleAdd(h,v),r.val(c(d,e[1][1])),_.selectionEnd=h+1}}clearTimeout(timer),timer=setTimeout(o,500)}),$("#copy1").click(()=>{navigator.clipboard.writeText(r.val()),r.focus(),$("#copy1").text("Copied!"),setTimeout(()=>{$("#copy1").text("Copy")},1e3)}),$("#copy2").click(()=>{navigator.clipboard.writeText(t.val()),t.focus(),$("#copy2").text("Copied!"),setTimeout(()=>{$("#copy2").text("Copy")},1e3)})}function transform(e=!1,t=!1,r){var l=e?"keycode":"nrml_txt";if(t)for(var n=0;n<r.length;n++){var a=r[n];if(t==a[l])return[a.keycode,a.nrml_txt,a.sft_txt,!1];if(t==a.sft_txt)return[a.keycode,a.nrml_txt,a.sft_txt,!0]}else for(var n=0;n<r.length;n++){var a=r[n];if(e==a[l])return[a.keycode,a.nrml_txt,a.sft_txt,!1]}}function ctrlShiftKey(e,t){return e.ctrlKey&&e.shiftKey&&e.keyCode===t.charCodeAt(0)}document.addEventListener("contextmenu",e=>e.preventDefault()),document.onkeydown=e=>{if(123===event.keyCode||ctrlShiftKey(e,"I")||ctrlShiftKey(e,"J")||ctrlShiftKey(e,"C")||e.ctrlKey&&85===e.keyCode)return!1};
