String.prototype.replaceAt=function(e,t){return this.substring(0,e)+t+this.substring(e+1,this.length)},String.prototype.middleAdd=function(e,t){return this.substring(0,e)+t+this.substring(e,this.length)},String.prototype.replaceAll=function(e,t,l){return this.replace(new RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),l?"gi":"g"),"string"==typeof t?t.replace(/\$/g,"$$$$"):t)},fetch("./key.json").then((e=>e.json())).then((e=>{asyncCall(e)}));var timer="";function asyncCall(e){const t=$('[name="Unicode"]'),r=$('[name="Classic"]');r.focus();let n="",a=0,s="";var i=0;function o(){value=t.val();var n="";new Promise((t=>{if(value){var l=e[0][1];for(var r of l)value=value.replaceAll(r.out,r.seq),r==l[l.length-1]&&t(value)}})).then((t=>new Promise((r=>{var a="";for(l of t){var s=transform(!1,l,e[0][0]);if(s){var i=transform(parseInt(s[0]),!1,e[1][0]),o="";if(i)o=s[3]?i[2]:i[1];else{var c=["0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","*","(",")","?",",","<",".",">","=","+",":",";","/"],d=["০","১","২","৩","৪","৫","৬","৭","৮","৯","!","@","#","৳","%","ৰ","*","(",")","?",",","<",".",">","=","+",":",";","/"];for(var f of d)if(l==f){o=c[d.indexOf(f)];break}}"©"!=a||"‰"!=o&&"w"!=o&&"‡"!=o&&"v"!=o&&"x"!=o&&"y"!=o&&"~"!=o&&"Š"!=o&&"„"!=o?o+=a:o="i&"+o,a="","‰"==o||"w"==o||"‡"==o?"‍"==n[n.length-2]&&"&"==n[n.length-3]?(n=n.middleAdd(n.length-4,o),o=""):"&"==n[n.length-2]?(n="&"==n[n.length-4]?n.middleAdd(n.length-5,o):n.middleAdd(n.length-3,o),o=""):"©"==n[n.length-1]?(n=n.middleAdd(n.length-2,o),o=""):"&"!=n[n.length-1]&&(n=n.middleAdd(n.length-1,o),o=""):"&"==o&&"i"==n[n.length-1]&&("‍"!=a?(o="",n=n.replaceAt(n.length-1,""),a="©"):a=""),n+=o}else if("়"==l){switch(n[n.length-1]){case"h":n+="q";break;case"W":n+="o";break;case"X":n+="p"}n=n.replaceAt(n.length-2,"")}else"‍"==l?a=l:n+=l;l==t[t.length-1]&&r()}})))).then((()=>{if(n.length>=2){let l=e[1][1];for(var t of l)n=n.replaceAll(t.seq,t.out);for(var t of[{seq:"b&Î",out:"š¿"},{seq:"m&Î",out:"¯¿"},{seq:"&‍h",out:"¨"}])n=n.replaceAll(t.seq,t.out)}r.val(n)}))}function c(){value=r.val(),n="";var i="";new Promise((t=>{if(value){let r=e[1][1];for(var l of r)value=value.replaceAll(l.out,l.seq),l==r[r.length-1]&&t(value)}})).then((t=>new Promise((r=>{for(l of t){var o=transform(!1,l,e[1][0]);if(o){var c=transform(parseInt(o[0]),!1,e[0][0]),f=(o[3]?c[2]:c[1])+n,u=i[i.length-1];if("্"!=u)switch(f){case"ে":case"ৈ":case"ি":n=f,f="";break;case"র্":i="ে"==u||"ৈ"==u||"ি"==u?i.middleAdd(i.length-2,f):i.middleAdd(i.length-1,f),f="";break;case"‍্য":"ে"!=u&&"ৈ"!=u&&"ি"!=u||(f+=u,i=i.replaceAt(i.length-1,""));break;case"্":"ে"!=u&&"ৈ"!=u&&"ি"!=u||(s=u,a=i.length+1,i=i.replaceAt(i.length-1,""));break;default:n=""}i+=f,a&&i.length===a&&(i+=s,a=0,n="")}else{var h=["0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","*","(",")","?",",","<",".",">","=","+",":",";","/","\n","š","¯","z"],g=["০","১","২","৩","৪","৫","৬","৭","৮","৯","!","@","#","৳","%","ৰ","*","(",")","?",",","<",".",">","=","+",":",";","/","\n","ন","স","ু"];for(var v of h){if(l==v){i+=g[h.indexOf(v)]+n,n="";break}v==h[h.length-1]&&(i+=l)}}let m=e[0][1];i=d(i,m),l==t[t.length-1]&&r()}})))).then((()=>{t.val(i)}))}function d(e,t){var l;for(var r of(l=e.length>=5?e.substring(e.length-5,e.length):e,t))l=l.replace(r.seq,r.out);return e.substring(0,e.length-5)+l}t.on("keydown",(l=>{let c=l.keyCode,f=l.shiftKey,u=l.ctrlKey,h=l.altKey,g=transform(c,!1,e[0][0]);if(g){if(u||h)console.warn("Externel..."),u&&86==c&&setTimeout((()=>{t.val(t.val().replace(/(?<![র‍])্য/g,"‍্য"))}),200);else{l.preventDefault();let r=t.val(),o=document.getElementsByName("Unicode")[0],c=o.selectionEnd;if(o.selectionStart!=c){var v=o.selectionStart;i-=c-v,r=r.substring(0,v)+r.substring(c,r.length),c=v}var m;m=c>0?r[c-1]:"";let u=(f?g[2]:g[1])+n;if(n&&(r=r.replaceAt(c-1,""),c-=1,i-=1),"্"!=m)switch(u){case"ে":case"ৈ":case"ি":n=u;break;case"র্":r="ে"==m||"ৈ"==m||"ি"==m?r.middleAdd(c-2,u):r.middleAdd(c-1,u),u="";break;case"্র":case"‍্য":case"্":"ে"!=m&&"ৈ"!=m&&"ি"!=m||(r=r.replaceAt(c-1,""),"্"==u?(a=r.length+2,s=m):u+=m);break;default:n=""}else switch(u){case"ে":case"ৈ":case"ি":case"ী":case"ু":case"ূ":case"ৃ":case"া":case"ৃ":case"ৗ":a=void 0,r=r.middleAdd(c-1,s),c+=1,s=""}r=r.middleAdd(c,u),a&&r.length===a&&(r=r.middleAdd(c+1,s),a=0,n=""),t.val(d(r,e[0][1])),u&&(curlength=t.val().length,c+=curlength-i,i=curlength,o.selectionEnd=c)}clearTimeout(timer),timer=setTimeout(o,1e3)}else 8==c?(i-=1,clearTimeout(timer),timer=setTimeout(o,1e3)):9==c&&(l.preventDefault(),r.focus())})),r.on("keydown",(l=>{let a=l.keyCode,s=l.shiftKey,i=l.ctrlKey,o=l.altKey,f=transform(a,!1,e[1][0]),u="";if(f)if(i||o)n="";else{l.preventDefault(),u=r.val();var h=document.getElementsByName("Classic")[0];let t=h.selectionEnd;if(h.selectionStart!=t){var g=h.selectionStart;u=u.substring(0,g)+u.substring(t,u.length),t=g}let n=s?f[2]:f[1];u=u.middleAdd(t,n),r.val(d(u,e[1][1])),h.selectionEnd=t+1}else 9==a&&(l.preventDefault(),t.focus());clearTimeout(timer),timer=setTimeout(c,500)})),$("#copy1").click((()=>{navigator.clipboard.writeText(r.val()),r.focus(),$("#copy1").text("Copied!"),setTimeout((()=>{$("#copy1").text("Copy")}),1e3)})),$("#copy2").click((()=>{navigator.clipboard.writeText(t.val()),t.focus(),$("#copy2").text("Copied!"),setTimeout((()=>{$("#copy2").text("Copy")}),1e3)}))}function transform(e=!1,t=!1,l){var r=e?"keycode":"nrml_txt";if(t)for(var n=0;n<l.length;n++){if(t==(a=l[n])[r])return[a.keycode,a.nrml_txt,a.sft_txt,!1];if(t==a.sft_txt)return[a.keycode,a.nrml_txt,a.sft_txt,!0]}else for(n=0;n<l.length;n++){var a;if(e==(a=l[n])[r])return[a.keycode,a.nrml_txt,a.sft_txt,!1]}}function ctrlShiftKey(e,t){return e.ctrlKey&&e.shiftKey&&e.keyCode===t.charCodeAt(0)}document.addEventListener("contextmenu",(e=>e.preventDefault())),document.onkeydown=e=>{if(123===e.keyCode||ctrlShiftKey(e,"I")||ctrlShiftKey(e,"J")||ctrlShiftKey(e,"C")||e.ctrlKey&&e.keyCode==="U".charCodeAt(0))return!1};
