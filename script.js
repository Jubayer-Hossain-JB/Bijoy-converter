String.prototype.replaceAt=function(e,t){return this.substring(0,e)+t+this.substring(e+1,this.length)},String.prototype.middleAdd=function(e,t){return this.substring(0,e)+t+this.substring(e,this.length)},String.prototype.replaceAll=function(e,t,l){return this.replace(RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),l?"gi":"g"),"string"==typeof t?t.replace(/\$/g,"$$$$"):t)},fetch("./key.json").then(e=>e.json()).then(e=>{asyncCall(e)});var timer="";function asyncCall(e){let t=$('[name="Unicode"]'),l=$('[name="Classic"]');l.focus();let r="",a=0,n="";var s=0;function i(){value=t.val();var r="";new Promise(t=>{if(value){var l=e[0][1];for(var r of l)value=value.replaceAll(r.out,r.seq),r==l[l.length-1]&&t(value)}}).then(t=>new Promise(l=>{var a="";for(l of t){var n=transform(!1,l,e[0][0]);if(n){var s=transform(parseInt(n[0]),!1,e[1][0]),i="";if(s)i=n[3]?s[2]:s[1];else{var c=["0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","*","(",")","?",",","<",".",">","=","+",":",";","/"],o=["০","১","২","৩","৪","৫","৬","৭","৮","৯","!","@","#","৳","%","ৰ","*","(",")","?",",","<",".",">","=","+",":",";","/"];for(var f of o)if(l==f){i=c[o.indexOf(f)];break}}"\xa9"==a&&("‰"==i||"w"==i||"‡"==i||"v"==i||"x"==i||"y"==i||"~"==i||"Š"==i||"„"==i)?i="i&"+i:i+=a,a="","‰"==i||"w"==i||"‡"==i?"‍"==r[r.length-2]&&"&"==r[r.length-3]?(r=r.middleAdd(r.length-4,i),i=""):"&"==r[r.length-2]?(r="&"==r[r.length-4]?r.middleAdd(r.length-5,i):r.middleAdd(r.length-3,i),i=""):"\xa9"==r[r.length-1]?(r=r.middleAdd(r.length-2,i),i=""):"&"!=r[r.length-1]&&(r=r.middleAdd(r.length-1,i),i=""):"&"==i&&"i"==r[r.length-1]&&("‍"!=a?(i="",r=r.replaceAt(r.length-1,""),a="\xa9"):a=""),r+=i}else if("়"==l){switch(r[r.length-1]){case"h":r+="q";break;case"W":r+="o";break;case"X":r+="p"}r=r.replaceAt(r.length-2,"")}else"‍"==l?a=l:l.match(/[^a-zA-Z]/)&&(r+=l);l==t[t.length-1]&&l()}})).then(()=>{if(r.length>=2){let t=e[1][1];for(var a of t)r=r.replaceAll(a.seq,a.out);for(var a of[{seq:"b&\xce",out:"š\xbf"},{seq:"m&\xce",out:"\xaf\xbf"},{seq:"&‍h",out:"\xa8"},{seq:"m&\xb5",out:"\xafŒ"}])r=r.replaceAll(a.seq,a.out)}l.val(r)})}function c(){value=l.val(),r="";var s="";new Promise(t=>{if(value){let l=e[1][1];for(var r of[{seq:"†",out:"‡"},{seq:"\xa1",out:"&e"},{seq:"\xafŒ",out:"m&K&i"}])value=value.replaceAll(r.seq,r.out);for(var r of l)value=value.replaceAll(r.out,r.seq),r==l[l.length-1]&&t(value)}}).then(t=>new Promise(l=>{for(l of t){var i=transform(!1,l,e[1][0]);if(i){var c=transform(parseInt(i[0]),!1,e[0][0]),f=(i[3]?c[2]:c[1])+r,d=s[s.length-1];if("্"!=d)switch(f){case"ে":case"ৈ":case"ি":r=f,f="";break;case"র্":s="ে"==d||"ৈ"==d||"ি"==d?s.middleAdd(s.length-2,f):s.middleAdd(s.length-1,f),f="";break;case"‍্য":("ে"==d||"ৈ"==d||"ি"==d)&&(f+=d,s=s.replaceAt(s.length-1,""));break;case"্":("ে"==d||"ৈ"==d||"ি"==d)&&(n=d,a=s.length+1,s=s.replaceAt(s.length-1,""));break;default:r=""}s+=f,a&&s.length===a&&(s+=n,a=0,r="")}else{var u=["0","1","2","3","4","5","6","7","8","9","$","^","š","\xaf","z"],_=["০","১","২","৩","৪","৫","৬","৭","৮","৯","৳","ৰ","ন","স","ু"];for(var h of u){if(l==h){s+=_[u.indexOf(h)]+r,r="";break}h==u[u.length-1]&&(s+=l)}}s=o(s,e[0][1]),l==t[t.length-1]&&l()}})).then(()=>{t.val(s)})}function o(e,t){var l;for(var r of(l=e.length>=5?e.substring(e.length-5,e.length):e,t))l=l.replace(r.seq,r.out);return e.substring(0,e.length-5)+l}t.on("keydown",c=>{let f=c.keyCode,d=c.shiftKey,u=c.ctrlKey,_=c.altKey,h=transform(f,!1,e[0][0]);if(h){if(u||_)console.warn("Externel..."),u&&86==f&&setTimeout(()=>{t.val(t.val().replace(/(?<![র‍])্য/g,"‍্য"))},200);else{c.preventDefault();let g=t.val(),v=document.getElementsByName("Unicode")[0],p=v.selectionEnd;if(v.selectionStart!=p){var m,y=v.selectionStart;s-=p-y,g=g.substring(0,y)+g.substring(p,g.length),p=y}m=p>0?g[p-1]:"";let A=(d?h[2]:h[1])+r;if(r&&(g=g.replaceAt(p-1,""),p-=1,s-=1),"্"!=m)switch(A){case"ে":case"ৈ":case"ি":r=A;break;case"র্":g="ে"==m||"ৈ"==m||"ি"==m?g.middleAdd(p-2,A):g.middleAdd(p-1,A),A="";break;case"্র":case"‍্য":case"্":("ে"==m||"ৈ"==m||"ি"==m)&&(g=g.replaceAt(p-1,""),"্"==A?(a=g.length+2,n=m):A+=m);break;default:r=""}else switch(A){case"ে":case"ৈ":case"ি":case"ী":case"ু":case"ূ":case"ৃ":case"া":case"ৃ":case"ৗ":a=void 0,g=g.middleAdd(p-1,n),p+=1,n=""}g=g.middleAdd(p,A),a&&g.length===a&&(g=g.middleAdd(p+1,n),a=0,r=""),t.val(o(g,e[0][1])),A&&(p+=(curlength=t.val().length)-s,s=curlength,v.selectionEnd=p)}clearTimeout(timer),timer=setTimeout(i,1e3)}else 8==f?(s-=1,clearTimeout(timer),timer=setTimeout(i,1e3)):9==f&&(c.preventDefault(),l.focus(),r="",a="",n="")}),l.on("keydown",s=>{let i=s.keyCode,f=s.shiftKey,d=s.ctrlKey,u=s.altKey,_=transform(i,!1,e[1][0]),h="";if(_){if(d||u)r="",d&&86==i&&setTimeout(()=>{l.val(l.val().replace(/\u2022(?![LNg\u00ff(\u00ffy)(\u00ffz)(\u00ff~)(\u00ff\u201a)(\u00ff\u201e)(\u00ff\u2026)])/g,"\xb7"))},200);else{s.preventDefault(),h=l.val();var g=document.getElementsByName("Classic")[0];let v=g.selectionEnd;if(g.selectionStart!=v){var p=g.selectionStart;h=h.substring(0,p)+h.substring(v,h.length),v=p}let m=f?_[2]:_[1];h=h.middleAdd(v,m),l.val(o(h,e[1][1])),g.selectionEnd=v+1}}else 9==i&&(s.preventDefault(),t.focus(),r="",a="",n="");clearTimeout(timer),timer=setTimeout(c,500)}),$("#copy1").click(()=>{navigator.clipboard.writeText(l.val()),l.focus(),$("#copy1").text("Copied!"),setTimeout(()=>{$("#copy1").text("Copy")},1e3)}),$("#copy2").click(()=>{navigator.clipboard.writeText(t.val()),t.focus(),$("#copy2").text("Copied!"),setTimeout(()=>{$("#copy2").text("Copy")},1e3)})}function transform(e=!1,t=!1,l){var r=e?"keycode":"nrml_txt";if(t)for(var a=0;a<l.length;a++){var n=l[a];if(t==n[r])return[n.keycode,n.nrml_txt,n.sft_txt,!1];if(t==n.sft_txt)return[n.keycode,n.nrml_txt,n.sft_txt,!0]}else for(var a=0;a<l.length;a++){var n=l[a];if(e==n[r])return[n.keycode,n.nrml_txt,n.sft_txt,!1]}}
